generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(uuid())
  email       String   @unique
  name        String?
  phone       String?
  role        UserRole @default(DRIVER)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  vehicles    Vehicle[]
  assignments Assignment[]
  trips       Trip[]   @relation("TripAssignedToUser")   // FIXED
}


model Vehicle {
  id        String    @id @default(uuid())
  name      String
  vin       String?   @unique
  driver    User?     @relation(fields: [driverId], references: [id])
  driverId  String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  locations Location[]
  trips     Trip[]
}

model Trip {
  id          String      @id @default(uuid())
  pickupLat   Float
  pickupLng   Float
  dropLat     Float
  dropLng     Float
  status      TripStatus  @default(PENDING)
  assignedTo  User?       @relation("TripAssignedToUser", fields: [assignedToId], references: [id])   // FIXED
  assignedToId String?
  vehicle     Vehicle?    @relation(fields: [vehicleId], references: [id])
  vehicleId   String?
  eta         DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  assignments Assignment[]
}


model Assignment {
  id        String             @id @default(uuid())
  trip      Trip               @relation(fields: [tripId], references: [id])
  tripId    String
  user      User               @relation(fields: [userId], references: [id])
  userId    String
  status    AssignmentStatus   @default(PENDING)
  createdAt DateTime           @default(now())
}

model Location {
  id         String   @id @default(uuid())
  vehicle    Vehicle  @relation(fields: [vehicleId], references: [id])
  vehicleId  String
  lat        Float
  lng        Float
  speed      Float?
  heading    Float?
  recordedAt DateTime @default(now())
}

enum UserRole {
  ADMIN
  DISPATCHER
  DRIVER
}

enum TripStatus {
  PENDING
  ASSIGNED
  EN_ROUTE
  DELIVERED
  CANCELLED
}

enum AssignmentStatus {
  PENDING
  ACCEPTED
  REJECTED
  CANCELLED
}
